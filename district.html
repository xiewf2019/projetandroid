<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">
<head><title>DÃ©coupage 2020 </title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
<meta charset="UTF-8">
<style>
.button {
  background-color: red; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
.button0  {background-color: red;}
.button1 {background-color: blue;} /* Blue */
.button2 {background-color: yellow;color: black} /* Red */ 
.button3 {background-color: green;} /* Gray */ 
.button4 {background-color: magenta;} /* Black */
</style></head>

<body >
	
  <h1>L'Ain (01)</h1>
  <h2 id="pourcentage"></h2>
  <div>
  	<!-- <svg id=sv height="130" width="500">
  		
		  <polygon points="200,10 250,190 160,210 100,50"  onclick="myfunction()" />
		  <text fill="#ffffff" font-size="45" font-family="Verdana"
		  x="50" y="86">SVG</text>
	 </svg> -->
  
  <script >
        var colortab=["red","blue","yellow","green","magenta","black",]
        var length=3
        var color=color
        var data=0
       
        function train(result){
            var svg=document.createElementNS('http://www.w3.org/2000/svg','svg');   
            svg.setAttribute("style","width:100%;height:100%;");
            svg.setAttribute("viewBox","20 55 200 200");
            data= result.length
            for(var i = 0; i < result.length; i++){
              var polygon=document.createElementNS('http://www.w3.org/2000/svg','polygon');
              s=""
              var x=0
              var y=0
              for (var j=0; j < result[i].geometry.coordinates[0].length; j++){
                x+=Math.round(result[i].geometry.coordinates[0][j][0]*100-450);
                y+=Math.round(result[i].geometry.coordinates[0][j][1]*100-4500);
                s= s+Math.round(result[i].geometry.coordinates[0][j][0]*100-450)+","+Math.round(result[i].geometry.coordinates[0][j][1]*100-4500)+" "
              }
              x=x/result[i].geometry.coordinates[0].length;
              y=y/result[i].geometry.coordinates[0].length;
              //console.log(result.length)
              polygon.setAttribute("points",s)
              polygon.setAttribute("fill",colortab[length])
              polygon.setAttribute("stroke","white")

              var idcanton= result[i].properties.canton;
              polygon.setAttribute("id","p"+idcanton);

              var text=document.createElementNS('http://www.w3.org/2000/svg','text');
              text.setAttribute("id",idcanton)
              text.setAttribute("x",Math.round(x))
              text.setAttribute('y', Math.round(y));
              text.setAttribute('fill', 'black');
              text.setAttribute('font-size','3px')
              text.setAttribute("onclick","changecolor(this)")
              text.textContent = idcanton; 
              svg.appendChild(polygon);
              svg.appendChild(text);
            }
            var text= document.createElement("p");
            text.innerHTML="button pour choisir les groupe";
            document.body.appendChild(text);
            for(var i = 0; i <=length; i++){
              var b=document.createElement("BUTTON");
              b.innerHTML=colortab[i];
              b.setAttribute("class","button button"+i);
              b.setAttribute("onclick","getcolor("+i+")");
              document.body.appendChild(b);

            } 
            var text2= document.createElement("p");
            text2.innerHTML="button afficher resulta ou reset le graphe";
            document.body.appendChild(text2);

            var submit=document.createElement("BUTTON");
            submit.innerHTML="submit";
            submit.setAttribute("class","button button0");
            submit.setAttribute("onclick","submit1()");
            document.body.appendChild(submit);
            var reset=document.createElement("BUTTON");
            reset.innerHTML="reset";
            reset.setAttribute("class","button button0");
            reset.setAttribute("onclick","reset()");
            document.body.appendChild(reset);
            document.body.appendChild(svg);
            
        }
        function submit1(){
              list1=[]
              list2=[]
              list3=[]
              for(var i = 1; i <= data; i++){
                if(i<10){var d=document.getElementById("p0"+i);}
                else{var d=document.getElementById("p"+i);}
                var color_c=d.getAttribute("fill");
                console.log(color_c)
                if(color_c==colortab[0])
                  list1.push(i);
                if(color_c==colortab[1])
                  list2.push(i);
                if(color_c==colortab[2])
                  list3.push(i);
              }
              
              var a=list1.toString();
              var b=list2.toString();
              var c=list3.toString();
              console.log(a)
              //alert(a+b+c)
              $.ajax({
                        url: 'show_district',
                        type: 'POST',
                          data: {
                         'list1':a ,
                         'list2':b,
                         'list3':c
                        }

                    ,dataType: 'html',
                    success: function(result){
                        var arr=result.split(",");
                        //alert(arr.length);
                        if(arr.length<=1){
                          alert("desicion impossible");
                          return;
                                        }

                        for(var i = 1; i <=data; i++){
                          if (i==1){var x=parseInt(arr[i-1][2]);}
                          else{var x=parseInt(arr[i-1][2]);}
                          
                          console.log(x);
                          if(i<10){var d=document.getElementById("p0"+i);}
                          else{var d=document.getElementById("p"+i);}
                          d.setAttribute("fill",colortab[x]);


                        }
                        var tab=[];
                        for(var i =data+1;i<arr.length;i++){
                          var x=parseFloat(arr[i].substring(2,6));
                          tab.push(x);
                          
                        }

                        var d= document.getElementById("pourcentage");
                        d.innerHTML="ratio population   groupe0 "+tab[0]+"  groupe1 "+tab[1]+"  groupe2 "+tab[2];
                        //   if(i<10){var d=document.getElementById("p0"+i);}
                        //   else{var d=document.getElementById("p"+i);}

                    //alert du echo fait en php
                    
                    }


              })
        }
        function reset(){
          for(var i = 1; i <= data; i++){
                if(i<10){var d=document.getElementById("p0"+i);}
                else{var d=document.getElementById("p"+i);}
               d.setAttribute("fill",colortab[length]);
               
              }
            var d= document.getElementById("pourcentage");
            d.innerHTML="";

        }
        
        function changecolor(b){
          var idcanton=b.id;
          var polygon=document.getElementById("p"+idcanton);
          console.log(b.id)
          polygon.setAttribute("fill",color);
        }
        function getcolor(a){
          color= colortab[a]
        }
      

  </script>
  <script type="text/javascript" src="a.json?callback=train"></script>
 

  
</body>

</html>
