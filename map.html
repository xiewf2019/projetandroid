<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">
<head><title>DÃ©coupage 2020 </title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
<meta charset="UTF-8">
<body onload=creer_map()>
	
  <h1>Map de france</h1>
  <script >
  	function readTextFile(file, callback) {
	    var rawFile = new XMLHttpRequest();
	    rawFile.overrideMimeType("application/json");
	    rawFile.open("GET", file, true);
	    rawFile.onreadystatechange = function() {
	        if (rawFile.readyState === 4 && rawFile.status == "200") {
	            callback(rawFile.responseText);
	        }
	    }
	    rawFile.send(null);
	}
	function creer_map(){
		var svg=document.createElementNS('http://www.w3.org/2000/svg','svg');   
        svg.setAttribute("style"," border:1px solid #cd0000;width:100%;height:100%;");
        svg.setAttribute("viewBox","-500 -380 1500 1000");

       
        
		var path="departments-simplified-by-geoapi.json";
		var rawFile = new XMLHttpRequest();
	    rawFile.overrideMimeType("application/json");
	    rawFile.open("GET", path, true);
	    console.log(rawFile.readyState)
	    console.log(rawFile.status)
	    rawFile.onreadystatechange = function() {
	        if (rawFile.readyState === 4 && rawFile.status == "200") {
	            var result=rawFile.responseText;
	  
		
				var data = JSON.parse(result);
				console.log(data[0].fields)
				//console.log(data[0].fields.fields_geom.coordinates[1][0]);
				for(var i = 0; i < data.length; i++){
				 	var polygon=document.createElementNS('http://www.w3.org/2000/svg','polygon');
				 	if(data[i].fields!=data[95].fields){
					 	var list=data[i].fields.fields_geom.coordinates.length
					 	var type =data[i].fields.fields_geom.type
					 	if (type=="Polygon"){
					 		s=""
					 		for (var j=0; j < data[i].fields.fields_geom.coordinates[0].length; j++){
				// //             // x+=Math.round(result[i].geometry.coordinates[0][j][0]*100-450);
				// //             // y+=Math.round(result[i].geometry.coordinates[0][j][1]*100-4500);
				//              //console.log(data[i].fields.fields_geom.coordinates[k][0][j])
				              s= s+Math.round(data[i].fields.fields_geom.coordinates[0][j][0]*100)+","+Math.round(data[i].fields.fields_geom.coordinates[0][j][1]*100-4500)+" "
				           	}
				           
			          		//console.log(i)
			          		//console.log(s)
	          				polygon.setAttribute("points",s)
							polygon.setAttribute("fill","red")
							polygon.setAttribute("stroke","white")
							//polygon.setAttribute("id","p"+i);
							svg.appendChild(polygon);
							var text=document.createElementNS('http://www.w3.org/2000/svg','text');
							
							var x=Math.round(data[i].fields.geo_point_2d[1]*100)
							var y=Math.round(data[i].fields.geo_point_2d[0]*100-4500)
							text.setAttribute("id",i)
							text.setAttribute("x",x)
							text.setAttribute('y', y);
							text.setAttribute('fill', 'black');
							text.setAttribute('font-size','10px')
							text.setAttribute("onclick","jump(this)")
							text.textContent = data[i].fields.fields_nom_dep;
							svg.appendChild(text);
					 			
			       
				           

					 	}
					 	//console.log(data[i])
				 	
					 	else{
					 		s=""
		        			for(var k=0; k < list; k++){
		   // 					//var x=0
		   // //     			//var y=0
		   						
		    					var l=data[i].fields.fields_geom.coordinates[k][0].length
		            			for (var j=0; j < l; j++){
					// //             // x+=Math.round(result[i].geometry.coordinates[0][j][0]*100-450);
					// //             // y+=Math.round(result[i].geometry.coordinates[0][j][1]*100-4500);
					//              //console.log(data[i].fields.fields_geom.coordinates[k][0][j])
					              s= s+Math.round(data[i].fields.fields_geom.coordinates[k][0][j][0]*100)+","+Math.round(data[i].fields.fields_geom.coordinates[k][0][j][1]*100-4500)+" "
					           }
					        }
				

					//           		//console.log(s)
					        polygon.setAttribute("points",s)
							polygon.setAttribute("fill","red")
							polygon.setAttribute("stroke","white")
							//polygon.setAttribute("id","p"+i);
							svg.appendChild(polygon);
							var text=document.createElementNS('http://www.w3.org/2000/svg','text');
							
							var x=Math.round(data[i].fields.geo_point_2d[1]*100)
							var y=Math.round(data[i].fields.geo_point_2d[0]*100-4500)
							text.setAttribute("id",i)
							text.setAttribute("x",x)
							text.setAttribute('y', y);
							text.setAttribute('fill', 'black');
							text.setAttribute('font-size','10px')
							text.setAttribute("onclick","jump()")
							text.textContent = data[i].fields.fields_nom_dep;
							svg.appendChild(text);
					 			
			     	
			     	}}
					//x=x/result[i].geometry.coordinates[0].length;
					//y=y/result[i].geometry.coordinates[0].length;
					 //console.log(result.length)
					

					// // var idcanton= result[i].properties.canton;
					

					// //var text=document.createElementNS('http://www.w3.org/2000/svg','text');
					// // text.setAttribute("id",idcanton)
					// // text.setAttribute("x",Math.round(x))
					// // text.setAttribute('y', Math.round(y));
					// // text.setAttribute('fill', 'black');
					// // text.setAttribute('font-size','3px')
					// // text.setAttribute("onclick","changecolor(this)")
					// // text.textContent = idcanton; 
					 
		   //        	//svg.appendChild(text);
	     		}
			   document.body.appendChild(svg);
	        
	  
			}
		}
		rawFile.send(null)

          
	}
	function jump(){
		location.replace("district.html")
	}
</script>
</body>

</html>

	